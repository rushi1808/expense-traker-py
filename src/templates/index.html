<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
    <h1>
        ðŸ’° Expense Tracker
        <span class="toggle" onclick="toggleDark()">ðŸŒ™</span>
    </h1>

    <a href="/add" class="button">âž• Add Expense</a>

    <table>
        <tr>
            <th>Sr</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Note</th>
            <th>Action</th>
        </tr>

        {% for e in expenses %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>â‚¹{{ e["amount"] }}</td>
            <td>{{ e["category"] }}</td>
            <td>{{ e["note"] }}</td>
            <td>
                <a href="/edit/{{ loop.index }}" class="button">Edit</a>
                <a href="/delete/{{ loop.index }}" class="button delete">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <canvas id="chart"></canvas>
</div>

<script id="chart-data" type="application/json">
{
  "categories": {{ expenses | map(attribute='category') | list | tojson }},
  "amounts": {{ expenses | map(attribute='amount') | list | tojson }}
}
</script>

<script>
function toggleDark() {
    document.body.classList.toggle("dark");
}

/* Read JSON safely */
const chartData = JSON.parse(
    document.getElementById("chart-data").textContent
);

new Chart(document.getElementById("chart"), {
    type: "bar",
    data: {
        labels: chartData.categories,
        datasets: [{
            label: "Expenses",
            data: chartData.amounts,
            backgroundColor: [
                "#36d1dc",
                "#5b86e5",
                "#ff4b2b",
                "#38ef7d",
                "#667eea"
            ]
        }]
    }
});
</script>
